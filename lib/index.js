!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e():"function"==typeof define&&define.amd?define([],e):"object"==typeof exports?exports.imageMosaic=e():t.imageMosaic=e()}("undefined"!=typeof self?self:this,function(){return function(t){var e={};function i(a){if(e[a])return e[a].exports;var o=e[a]={i:a,l:!1,exports:{}};return t[a].call(o.exports,o,o.exports,i),o.l=!0,o.exports}return i.m=t,i.c=e,i.d=function(t,e,a){i.o(t,e)||Object.defineProperty(t,e,{configurable:!1,enumerable:!0,get:a})},i.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return i.d(e,"a",e),e},i.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},i.p="",i(i.s=0)}([function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var a=function(){function t(t,e){for(var i=0;i<e.length;i++){var a=e[i];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(t,a.key,a)}}return function(e,i,a){return i&&t(e.prototype,i),a&&t(e,a),e}}();var o=function(){function t(e){var i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},a=i.tileWidth,o=void 0===a?10:a,r=i.tileHeight,n=void 0===r?10:r,l=i.brushSize,h=void 0===l?3:l;!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t);var s=e.canvas;this.context=e,this.brushSize=h,this.width=s.width,this.height=s.height,this.tileWidth=o,this.tileHeight=n;var u=this.width,c=this.height;this.imageData=e.getImageData(0,0,u,c).data,this.tileRowSize=Math.ceil(c/this.tileHeight),this.tileColumnSize=Math.ceil(u/this.tileWidth),this.tiles=[];for(var f=0;f<this.tileRowSize;f++)for(var d=0;d<this.tileColumnSize;d++){var p={row:f,column:d,pixelWidth:o,pixelHeight:n};d===this.column-1&&(p.pixelWidth=u-d*o),f===this.row-1&&(p.pixelHeight=c-f*n);for(var v=[],g=4*this.width*this.tileHeight*p.row+p.column*this.tileWidth*4,x=0,m=p.pixelHeight;x<m;x++){var y=g+4*this.width*x;v.push.apply(v,this.imageData.slice(y,y+4*p.pixelWidth))}p.data=v,this.tiles.push(p)}}return a(t,[{key:"drawTile",value:function(t){var e=this;(t=[].concat(t)).forEach(function(t){if(t.isFilled)return!1;if(!t.color){for(var i=t.data.length,a=0,o=0,r=0,n=0,l=0;l<i;l+=4)a+=t.data[l],o+=t.data[l+1],r+=t.data[l+2],n+=t.data[l+3];var h=i/4;t.color={r:parseInt(a/h,10),g:parseInt(o/h,10),b:parseInt(r/h,10),a:parseInt(n/h,10)}}var s=t.color;e.context.fillStyle="rgba("+s.r+", "+s.g+", "+s.b+", "+s.a/255+")";var u=t.column*e.tileWidth,c=t.row*e.tileHeight,f=t.pixelWidth,d=t.pixelHeight;e.context.clearRect(u,c,f,d),e.context.fillRect(u,c,f,d),t.isFilled=!0})}},{key:"drawTileByPoint",value:function(t,e){var i=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],a=this.getTilesByPoint(t,e,i);this.drawTile(a)}},{key:"getTilesByPoint",value:function(t,e){var i=[];if(!(arguments.length>2&&void 0!==arguments[2])||arguments[2])for(var a=this.brushSize,o=Math.max(0,Math.floor(e/this.tileHeight)-Math.floor(a/2)),r=Math.max(0,Math.floor(t/this.tileWidth)-Math.floor(a/2)),n=Math.min(this.tileRowSize,o+a),l=Math.min(this.tileColumnSize,r+a);o<n;){for(var h=r;h<l;)i.push(this.tiles[o*this.tileColumnSize+h]),h+=1;o+=1}return i}},{key:"drawAllTiles",value:function(){this.drawTile(this.tiles)}},{key:"eraseTile",value:function(t){var e=this;[].concat(t).forEach(function(t){var i=t.column*e.tileWidth,a=t.row*e.tileHeight,o=t.pixelWidth,r=t.pixelHeight,n=e.context.createImageData(o,r);t.data.forEach(function(t,e){n.data[e]=t}),e.context.clearRect(i,a,o,r),e.context.putImageData(n,i,a),t.isFilled=!1})}},{key:"eraseTileByPoint",value:function(t,e){var i=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],a=this.getTilesByPoint(t,e,i);this.eraseTile(a)}},{key:"eraseAllTiles",value:function(t){this.eraseTile(this.tiles)}}]),t}();e.default=o}])});